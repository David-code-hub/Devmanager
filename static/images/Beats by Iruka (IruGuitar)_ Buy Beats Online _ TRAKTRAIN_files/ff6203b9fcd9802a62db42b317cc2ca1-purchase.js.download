function updateCartCount(){$.ajax({url:"/cart/count",method:"GET",success:function success(a){var b=parseInt(a);0===b?$("#cartCount").html(""):$("#cartCount").html("("+b+")")},error:function error(){}})}$(document).on("click",".cart",function(a){a.preventDefault();var b=$(this).attr("data-id");cartSource=$(this).attr("data-source");var c=$(this).attr("data-name"),d=$(this).attr("data-brand"),e=this;$.ajax({url:"/buy/info/"+parseInt(b),method:"GET",success:function success(a){$("#lease-terms").html(a);var e=$("#lease-terms").remodal();$(".modal-lease-tabs").tab_modal(),e.open(),console.log(c),console.log(d),trackProductClick(c,b,d),leaseTermTabs(),tippy(document.querySelectorAll("[data-tippy]:not([data-tippy=\"\"])"),{zIndex:9999999,content:function content(a){var b=a.getAttribute("data-tippy");return b}})},error:function error(){toastr.error("Checkout error occured. Please contact administration","",{positionClass:"toast-top-center"})}},"html")});function getCartPosition(a){var b;if("DESKTOP"===DEVICE)b=$(a.target).parents(".remodal--lease-terms").find("div.active");else{var c=$("#current-term").val();b=$("ul[data-id="+c+"]")}return{trackId:b.attr("track"),rights:[b.attr("data-right")],price:b.attr("data-price"),name:b.attr("data-name"),brand:b.attr("data-brand")}}var animation_active_note=!1;$(document).on("click",".add2cart-modal",function(a){if(!animation_active){if($(a.target).hasClass("disabled"))return;if("Go to cart"===$(a.target).html())window.location.href="/cart";else{var b;b="false"===$("#isKit").val()?getCartPosition(a):{trackId:$("#kitId").val(),rights:["kitPrice"],name:$("#kitName").val(),brand:$("#buyModalProducer").val(),price:$("#kitPrice").val()},a.preventDefault(),$.ajax({url:"/cart/add/"+b.trackId+"/"+b.rights[0],method:"GET",success:function success(){"DESKTOP"===DEVICE?updateCartCount():updateCartTotal(),$(a.target).html("Go to cart"),toastr.success("Success","",{positionClass:"toast-top-center"}),window.dataLayer=window.dataLayer||[],console.log(b),trackAddToCart(b.name,b.trackId,b.price,b.brand,b.rights[0])},error:function error(){updateCartCount(),toastr.error("Error occurred, please contact administration. Track Id = "+data.trackId,"",{positionClass:"toast-top-center"})}})}}});function leaseTermTabs(){function a(a){var b=$(".remodal--lease-terms.remodal-is-opened"),c=b.find(".track-name").prop("scrollHeight"),d=b.find(".payment").prop("scrollHeight"),e=b.find(".remodal-controls").prop("scrollHeight");b.css("max-height",84+c+10+d+45+20+e+a)}var b=$("._js-lease-terms-accordion");b[0]&&b.each(function(){if($(this).hasClass("active")){var a=$(this).find(".lease-terms-accordion__panel");a.css("max-height",a.prop("scrollHeight"))}});var c,d;$(document).on("opened",".remodal--lease-terms",function(){var a=$(this),b=a.find(".active");c=a.find(".terms-tabs").prop("scrollHeight"),d=b.find(".lease-terms-accordion__panel").height()});var e=$("._js-lease-terms-accordion .lease-terms-accordion__button");e.click(function(){var b=$(this).parent();if(!b.hasClass("active")){var e=b.attr("track"),f=b.attr("data-right");$("#lease-terms > div.description > a.description__link").attr("href","/download-contract-preview/"+e+"/"+f),"true"===b.attr("data-tagged")?$("#lease-terms > div.description > div.description__text").text("The beat contains producer\u2019s tag."):$("#lease-terms > div.description > div.description__text").text(""),b.parent().find("._js-lease-terms-accordion").each(function(){$(this).removeClass("active"),$(this).find(".lease-terms-accordion__panel").css("max-height","0px")}),b.addClass("active");var g=b.find(".lease-terms-accordion__panel");g.css("max-height",g.prop("scrollHeight"));var h=c+g.prop("scrollHeight")-d;a(h)}})}function capitalize(a){return a[0].toUpperCase()+a.slice(1)}$(document).on("click",".js-free-download",function(a){a.preventDefault();var b=$(this).attr("data-id");cartSource=$(this).attr("data-source");this;$.ajax({url:"/social-download-form/"+parseInt(b),method:"GET",success:function success(a){var b=$(".js-free-download-remodal");if("string"==typeof a.link){var c="<iframe style=\"display: none;\" src=\""+a.link+"\"></iframe>";return void $("body").append(c)}b.removeClass("remodal--free-download-success"),b.removeClass("remodal--free-download-subscribe"),b.removeClass("remodal--free-download-email"),b.html(a),b.addClass(b.find(".js-socials-remodal-class").data("class"));var d=b.remodal();d.open(),"#ffdtt"===window.location.hash&&($(".traktrain[data-popup-url]").click(),window.location.hash="")},error:function error(a){if(401===a.status){var b=JSON.parse(a.responseText).url;openSigninModal(null,b)}else toastr.error("Failed to fetch track info","",{positionClass:"toast-top-center"})}},"html")}),$(document).on("click",".js-track-share",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=this;$.ajax({url:"/share-track/"+parseInt(b),method:"GET",success:function success(a){var b=$(".js-share-remodal-popup"),c=$(".js-share-remodal-content");c.html(a);var d=b.remodal();d.open()},error:function error(){}},"html")}),$(document).on("click",".js-share-button-email",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=this;$.ajax({url:"/share-track-email/"+parseInt(b),method:"GET",success:function success(a){var c=$(".js-share-email-remodal-popup"),d=$(".js-share-email-remodal-content");c.find(".arrow").attr("data-id",b),d.html(a);var e=grecaptcha.render(document.getElementById("shareByEmailCaptcha"),{sitekey:"6LfmENMUAAAAANjvOBo516oxee_oRjlOF8gXvNQw"}),f=c.remodal();f.open()},error:function error(){}},"html")});